<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ardesia Cloud Calendar</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body x-data="calendarApp()" x-init="init()">
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <h1 class="header-title">My Calendar</h1>
            <span class="header-subtitle">Ardesia Cloud</span>
        </div>
        <!-- Calendar Navigation -->
        <div class="calendar-nav">
            <button @click="previousMonth()" class="nav-btn">‚Äπ</button>
            <div class="nav-display">
                <select x-model.number="currentMonth" @change="updateCalendar()" class="month-select">
                    <template x-for="(month, index) in months">
                        <option :value="index" x-text="month"></option>
                    </template>
                </select>
                <select x-model.number="currentYear" @change="updateCalendar()" class="year-select">
                    <template x-for="year in availableYears">
                        <option :value="year" :disabled="!isYearActive(year)" x-text="year"></option>
                    </template>
                </select>
            </div>
            <button @click="nextMonth()" class="nav-btn">‚Ä∫</button>
            <button @click="goToToday()" class="today-btn">Today</button>
        </div>
        <!-- User Profile -->
        <div class="user-profile" @click.away="showUserMenu = false">
            <div class="user-avatar" @click="showUserMenu = !showUserMenu">
                <span x-text="user.initials"></span>
            </div>
            <div class="user-info" @click="showUserMenu = !showUserMenu">
                <div class="user-name" x-text="user.name"></div>
                <div class="user-role" x-text="user.role"></div>
            </div>
            <div x-show="showUserMenu" class="user-menu" x-transition>
                <div class="user-menu-header">
                    <div class="user-menu-name" x-text="user.name"></div>
                    <div class="user-menu-email" x-text="user.email"></div>
                </div>
                <div class="user-menu-divider"></div>
                <a href="#" class="user-menu-item">Account Settings</a>
                <a href="#" class="user-menu-item">Preferences</a>
                <div class="user-menu-divider"></div>
                <a href="#" class="user-menu-item user-menu-item-danger">Sign Out</a>
            </div>
        </div>
    </header>

    <!-- Main Calendar Container -->
    <main class="calendar-container">
        <!-- Calendar Grid -->
        <div class="calendar-grid">
            <!-- Day Headers -->
            <template x-for="day in dayNames">
                <div class="day-header" x-text="day"></div>
            </template>
            
            <!-- Calendar Days -->
            <template x-for="(day, index) in calendarDays">
                <div 
                    class="day-cell"
                    :class="{
                        'other-month': day.otherMonth,
                        'today': day.isToday,
                        'inactive-year': !isYearActive(day.year)
                    }"
                >
                    <div class="day-number" x-text="day.date"></div>
                    <template x-if="day.event">
                        <div 
                            class="event-block"
                            :class="{
                                'event-greyed': day.event.state === 'greyed',
                                'event-locked': day.event.state === 'locked',
                                'event-unlocked': day.event.state === 'unlocked'
                            }"
                            :style="getEventStyle(day.event)"
                            @click="handleEventClick(day.event)"
                        >
                            <div class="event-time-row">
                                <div class="event-time" x-text="formatEventTime(day.event)"></div>
                                <template x-if="day.event.participant">
                                    <div class="event-participant" x-text="day.event.participant"></div>
                                </template>
                            </div>
                            <div class="event-name">
                                <span x-show="day.event.state === 'locked'" class="lock-icon">üîí</span>
                                <span x-text="day.event.name"></span>
                            </div>
                        </div>
                    </template>
                </div>
            </template>
        </div>
    </main>

    <!-- Password Modal -->
    <div x-show="passwordModal.show" class="modal-overlay" @click.self="closePasswordModal()">
        <div class="modal-content">
            <h2>Unlock Event</h2>
            <p class="modal-event-name" x-text="passwordModal.event ? passwordModal.event.name : ''"></p>
            <input 
                type="password" 
                x-model="passwordModal.input"
                @keyup.enter="checkPassword()"
                placeholder="Enter password"
                class="password-input"
                autofocus
            >
            <div class="modal-actions">
                <button @click="checkPassword()" class="btn-primary">Unlock</button>
                <button @click="closePasswordModal()" class="btn-secondary">Cancel</button>
            </div>
            <p x-show="passwordModal.error" class="error-message" x-text="passwordModal.error"></p>
        </div>
    </div>

    <!-- Event Popover -->
    <div x-show="eventPopover.show" class="popover-overlay" @click.self="closeEventPopover()">
        <div class="popover-content">
            <button @click="closeEventPopover()" class="popover-close">√ó</button>
            <template x-if="eventPopover.event">
                <div>
                    <div class="popover-date" x-text="formatEventDate(eventPopover.event)"></div>
                    <h2 class="popover-title" x-text="eventPopover.event.name"></h2>
                    <div class="popover-time" x-text="formatEventTime(eventPopover.event)"></div>
                    <div class="popover-text">
                        <p x-text="eventPopover.event.content || 'No additional details available.'"></p>
                    </div>
                    <template x-if="eventPopover.event.media">
                        <div class="popover-media">
                            <template x-if="eventPopover.event.media.image">
                                <div class="media-placeholder media-image">
                                    <div class="media-icon">üñºÔ∏è</div>
                                    <div class="media-label">Image</div>
                                </div>
                            </template>
                            <template x-if="eventPopover.event.media.video">
                                <div class="media-placeholder media-video">
                                    <div class="media-icon">üé•</div>
                                    <div class="media-label">Video</div>
                                </div>
                            </template>
                            <template x-if="eventPopover.event.media.audio">
                                <div class="media-placeholder media-audio">
                                    <div class="media-icon">üéµ</div>
                                    <div class="media-label">Audio</div>
                                </div>
                            </template>
                        </div>
                    </template>
                    <template x-if="eventPopover.event.participant">
                        <div class="popover-attendee">
                            <span class="popover-attendee-label">Participant:</span>
                            <span class="popover-attendee-name" x-text="eventPopover.event.participant"></span>
                        </div>
                    </template>
                </div>
            </template>
        </div>
    </div>

    <!-- Subscription Success Message -->
    <div x-show="subscribeSuccess" class="success-message" x-transition>
        <p>Successfully subscribed! You'll receive updates about calendar changes.</p>
        <button @click="subscribeSuccess = false" class="close-btn">√ó</button>
    </div>

    <!-- Floating Subscribe Box (Bottom Left) -->
    <div class="floating-box floating-subscribe" :class="{ 'minimized': subscribeMinimized }">
        <div class="floating-box-header" @click="subscribeMinimized = !subscribeMinimized">
            <span>Subscribe to Updates</span>
            <button class="minimize-btn" x-text="subscribeMinimized ? '+' : '‚àí'"></button>
        </div>
        <div class="floating-box-content" x-show="!subscribeMinimized">
            <p>Get notified when the calendar is updated.</p>
            <input 
                type="email" 
                x-model="subscribeEmail"
                placeholder="Enter your email"
                class="subscribe-input"
                @keyup.enter="handleSubscribe()"
            >
            <button @click="handleSubscribe()" class="btn-primary">Subscribe</button>
        </div>
    </div>

    <!-- Floating Steam Wishlist Box (Bottom Right) -->
    <div class="floating-box floating-steam" :class="{ 'minimized': steamMinimized }">
        <div class="floating-box-header" @click="steamMinimized = !steamMinimized">
            <span>Imprinted</span>
            <button class="minimize-btn" x-text="steamMinimized ? '+' : '‚àí'"></button>
        </div>
        <div class="floating-box-content" x-show="!steamMinimized">
            <div class="wishlist-box"></div>
            <button class="btn-primary">Wishlist on Steam</button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <a href="#" class="footer-link">About</a>
        <a href="#" class="footer-link">Imprinted</a>
        <a href="#" class="footer-link">Cobalt Lane</a>
        <a href="#" class="footer-link">Substack</a>
        <a href="#" class="footer-link">Privacy</a>
        <a href="#" class="footer-link">Legal</a>
    </footer>

    <script src="app.js"></script>
</body>
</html>

